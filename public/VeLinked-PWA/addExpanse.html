<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VeLinked Driver</title>
    <link rel="stylesheet" href="css/navbar.css">
    <link rel="stylesheet" href="css/addExpanse.css">
    
    <script defer src="/__/firebase/10.9.0/firebase-app-compat.js"></script>
    <!-- include only the Firebase features as you need -->
    <script defer src="/__/firebase/10.9.0/firebase-auth-compat.js"></script>
    <script defer src="/__/firebase/10.9.0/firebase-database-compat.js"></script>
    <script defer src="/__/firebase/10.9.0/firebase-firestore-compat.js"></script>
    <script defer src="/__/firebase/10.9.0/firebase-functions-compat.js"></script>
    <script defer src="/__/firebase/10.9.0/firebase-messaging-compat.js"></script>
    <script defer src="/__/firebase/10.9.0/firebase-storage-compat.js"></script>
    <script defer src="/__/firebase/10.9.0/firebase-analytics-compat.js"></script>
    <script defer src="/__/firebase/10.9.0/firebase-remote-config-compat.js"></script>
    <script defer src="/__/firebase/10.9.0/firebase-performance-compat.js"></script>
    <!-- 
      initialize the SDK after all desired features are loaded, set useEmulator to false
      to avoid connecting the SDK to running emulators.
    -->
    <script defer src="/__/firebase/init.js?useEmulator=true"></script>
    
</head>
<body>

    <div class="header">
        <h2>Input your expenses</h2>

    </div>

    <div class="main-content">
        <div class="camera-container">
            <video id="camera-stream" autoplay playsinline></video>
            <canvas id="snapshot"></canvas>
            <img id="photo-preview" src="" alt="Photo preview" style="display:none;"/>
            <input type="file" id="image-file" accept="image/*" style="display:none;">
          
            <div class="controls">
                <img id="take-photo" src="assets/images/Photo.svg" alt="Take Photo">
                <img id="retake-photo" src="assets/images/Retake.svg" alt="Retake" style="display:none;">
            </div>
        </div>

        <!-- Form input expense -->
        <form class="expense-form" id="expense-form">
            <div class="form-group">
                <label for="expense-amount">Input your expense</label>
                <input type="number" id="expense-amount" name="expense-amount" placeholder="0.00" required>
            </div>

            <div class="form-group">
                <label for="expense-type">Expense type</label>
                <select id="expense-type" name="expense-type" required>
                    <option value="" disabled selected>Select type</option>
                    <option value="Gas">Gas</option>
                    <option value="Maintenance">Maintenance</option>
                    <option value="Toll">Toll</option>
                    <option value="Parking">Parking</option>
                </select>
            </div>

            <div class="form-group">
                <label for="description">Description</label>
                <input type="text" id="description" name="description" placeholder="description..." required>
            </div>

            <button type="submit" class="submit-button">Add New Expense</button>
        </form>
    </div>
      
      

    


    <div class="navbar">
        <a href="dashboard.html">
            <img src="assets/images/Nav-Dashboard.svg" alt="Dashboard" width="24" height="24">
        </a>
        <a href="Expanse.html">
            <img src="assets/images/Nav-Expanse-Active.svg" alt="Expanse" width="24" height="24">
        </a>
        <a href="#">
            <img src="assets/images/Nav-Attendance.svg" alt="Chat" width="24" height="24">
        </a>
        <a href="Profile.html">
            <img src="assets/images/Nav-Profile.svg" alt="Profile" width="24" height="24">
        </a>
    </div>


    <script>
        const cameraStream = document.getElementById('camera-stream');
        const photoPreview = document.getElementById('photo-preview');
        const takePhotoBtn = document.getElementById('take-photo');
        const retakePhotoBtn = document.getElementById('retake-photo');
        const snapshotCanvas = document.getElementById('snapshot');

        let stream;

        // Fungsi untuk memulai kamera belakang
        function startCamera() {
            navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
            .then(function(mediaStream) {
                stream = mediaStream;
                cameraStream.srcObject = stream;
            })
            .catch(function(err) {
                console.error('Error accessing camera: ', err);
            });
        }

        // Fungsi untuk mengambil foto
        function takePhoto() {
            const context = snapshotCanvas.getContext('2d');
            snapshotCanvas.width = cameraStream.videoWidth;
            snapshotCanvas.height = cameraStream.videoHeight;
            context.drawImage(cameraStream, 0, 0);
            
            const dataUrl = snapshotCanvas.toDataURL('image/png');
            photoPreview.src = dataUrl;
            photoPreview.style.display = 'block';
            cameraStream.style.display = 'none';
            
            retakePhotoBtn.style.display = 'inline';
            takePhotoBtn.style.display = 'none';
        }

        // Fungsi untuk foto ulang
        function retakePhoto() {
            photoPreview.src = '';
            photoPreview.style.display = 'none';
            cameraStream.style.display = 'block';
            
            retakePhotoBtn.style.display = 'none';
            takePhotoBtn.style.display = 'inline';
        }

        // Event listener
        takePhotoBtn.addEventListener('click', takePhoto);
        retakePhotoBtn.addEventListener('click', retakePhoto);

        // Jalankan kamera saat halaman dimuat
        startCamera();

        // Fungsi untuk submit form
        const form = document.getElementById('expense-form');
        form.addEventListener('submit', function(event) {
            event.preventDefault();
            const expenseAmount = document.getElementById('expense-amount').value;
            const expenseType = document.getElementById('expense-type').value;
            const description = document.getElementById('description').value;

            console.log('Expense Submitted:', {
                amount: expenseAmount,
                type: expenseType,
                description: description,
            });

            // Reset form after submit
            form.reset();
            photoPreview.src = '';
            photoPreview.style.display = 'none';
            cameraStream.style.display = 'block';
            retakePhoto();
        });
    </script>
</body>
</html>
