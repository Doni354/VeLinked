<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="VL/css/details.css">
    <link rel="stylesheet" href="VL/css/details_LiveTracking.css">
    <link rel="stylesheet" href="VL/css/details_User.css">
    <link rel="stylesheet" href="VL/css/details_Vehicle.css">
    <link rel="stylesheet" href="VL/css/details_LastTrip.css">
    <link rel="stylesheet" href="VL/css/details_VehicleList.css">
    <link rel="stylesheet" href="VL/css/details_VehicleFinance.css">
        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vehicle Details</title>
    <link rel="shortcut icon" href="assets/images/icon.svg" type="image/x-icon">
    <script defer src="/__/firebase/10.9.0/firebase-app-compat.js"></script>
        <script defer src="/__/firebase/10.9.0/firebase-auth-compat.js"></script>
        <script defer src="/__/firebase/10.9.0/firebase-database-compat.js"></script>
        <script defer src="/__/firebase/10.9.0/firebase-firestore-compat.js"></script>
        <script defer src="/__/firebase/10.9.0/firebase-functions-compat.js"></script>
        <script defer src="/__/firebase/10.9.0/firebase-messaging-compat.js"></script>
        <script defer src="/__/firebase/10.9.0/firebase-storage-compat.js"></script>
        <script defer src="/__/firebase/10.9.0/firebase-analytics-compat.js"></script>
        <script defer src="/__/firebase/10.9.0/firebase-remote-config-compat.js"></script>
        <script defer src="/__/firebase/10.9.0/firebase-performance-compat.js"></script>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Manrope:wght@200..800&display=swap">

        <script defer src="/__/firebase/init.js?useEmulator=true"></script>


</head>
<body style="background-color: #F5F4FF;">


    <div id="overlay" onclick="toggleForm()"></div>
    <div id="overlayEdit" onclick="toggleFormEdit()"></div>
                    <script>
                        function toggleForm() {
                            var overlay = document.getElementById("overlay");
                            var formContainer = document.getElementById("formContainer");

                            overlay.style.display = (overlay.style.display === "block") ? "none" : "block";
                            formContainer.style.display = (formContainer.style.display === "block") ? "none" : "block";
                        }
                        function toggleFormEdit() {
                            var overlay = document.getElementById("overlayEdit");
                            var formContainer = document.getElementById("formContainerEdit");

                            overlay.style.display = (overlay.style.display === "block") ? "none" : "block";
                            formContainer.style.display = (formContainer.style.display === "block") ? "none" : "block";
                        }

                    </script>
                    <div id="formContainer">
                        <div class="container">
                            <div class="heading">Vehicle Details <img src="assets/images/back.svg" alt="" onclick="toggleForm();"></div>
                            <div class="vehicle_Details-setting"></div>

                            <div class="button-container">
                                <button class="setting_button" onclick="toggleFormEdit()">
                                    <img src="assets/images/settings.svg" alt="">
                                </button>
                                <button id="deleteButton" class="del_button">
                                    <img src="assets/images/trash-can-solid.svg" alt="">
                                </button>
                            </div>
                        </div>
                    </div>
                    

                    <!-- Popup Confirmation Dialog -->

                    <div id="formContainerEdit">
                        <div class="container">
                            <div class="heading">Vehicle Edit <img src="assets/images/back.svg" alt="" onclick="toggleFormEdit();"></div>
                            <form class="form" id="vehicleForm">
                                <input  class="input" type="text" id="nickname" placeholder="Vehicle NickName">
                                <select class="input" name="type" id="type">
                                    <option value="" disabled selected hidden>Vehicle Type</option>
                                    <option value="car">Car</option>
                                    <option value="bus">Bus</option>
                                    <option value="truck">Truck</option>
                                </select>
                                <select class="input" name="brand" id="brand">
                                    <option value="" disabled selected hidden>Brand</option>
                                    <option value="Toyota">Toyota</option>
                                    <option value="Mitshubishi">Mitshubishi</option>
                                    <option value="Suzuki">Suzuki</option>
                                    <option value="Daihatsu">Daihatsu</option>
                                    <option value="Polestar">Polestar</option>
                                </select>
                                <input class="input" type="text" id="name" placeholder="Vehicle Name">
                                <input class="input" type="text" id="plate" placeholder="Plate no">
                                <input class="input" type="email" id="email" placeholder="Email Vehicle (optional)">
                                
                                <div class="input-container">
                                    <div class="input">
                                        <label for="pic">
                                            <img id="pic-preview" src="assets/images/Input-vehpic.svg" alt="">
                                        </label>
                                        <span id="file-name" class="file">No picture chosen (optional)</span>
                                    </div>
                                    <input class="input" style="visibility: hidden;" type="file" id="pic" accept="image/*">
                                </div>
                                
                                <input class="submit-button" type="submit" id="SaveVeh" value="Confirm">
                            </form>
                        </div>
                    </div>
                    

    <div class="data">
    <div class="LiveTracking">
        <div class="LTT">
            <p>Live Track</p>
            <div class="map-container" id="map"></div>

            <script src="https://maps.googleapis.com/maps/api/js?key=&callback=initMap&v=weekly&libraries=marker,geometry" async defer></script>
            <script>
                let map;
                let marker;
                let lat = -8.129252;
                let lng = 112.072306;
                let pathCoordinates = [];
                const MAX_POINTS = 100;
                const PAGINATION_OVERLAP = 10;  // Adjust overlap as needed
                let resetTimer;
                const FOCUS_DELAY = 10000; // 10 seconds in milliseconds
                let isUserInteracting = false;
            
                function initMap() {
                    const initialLocation = { lat: lat, lng: lng };
            
                    map = new google.maps.Map(document.getElementById("map"), {
                        zoom: 14,
                        center: initialLocation,
                        mapId: "DEMO_MAP_ID",
                        gestureHandling: 'greedy',  // Enable gestures to interact with the map
                    });
            
                    const glyphImg = document.createElement("img");
                    glyphImg.src = "https://developers.google.com/maps/documentation/javascript/examples/full/images/google_logo_g.svg";
            
                    const glyphSvgPinElement = new google.maps.marker.PinElement({
                        glyph: glyphImg,
                    });
            
                    marker = new google.maps.marker.AdvancedMarkerElement({
                        map,
                        position: initialLocation,
                        content: glyphSvgPinElement.element,
                        title: "Current Location",
                    });
            
                    document.getElementById('map').style.display = 'block';
            
                    pathCoordinates.push(initialLocation);
            
                    setInterval(updateLocation, 1000);
            
                    map.addListener('dragstart', () => {
                        isUserInteracting = true;
                        clearTimeout(resetTimer);  // Clear the reset timer when user starts interacting
                    });
                    map.addListener('dragend', () => {
                        isUserInteracting = false;
                        resetFocusTimer();
                    });
                    map.addListener('zoom_changed', () => {
                        if (map.getZoom() !== 14) { // Adjust zoom level threshold as needed
                            isUserInteracting = true;
                            clearTimeout(resetTimer);  // Clear the reset timer when user starts interacting
                        } else {
                            isUserInteracting = false;
                            resetFocusTimer();
                        }
                    });
                    map.addListener('idle', () => {
                        if (!isUserInteracting) {
                            resetFocusTimer();
                        }
                    });
                }
            
                function resetFocusTimer() {
                    clearTimeout(resetTimer);
                    resetTimer = setTimeout(() => {
                        if (!isUserInteracting) {
                            animateToMarker();
                        }
                    }, FOCUS_DELAY);
                }
            
                function animateToMarker() {
                    const targetPosition = marker.position;
                    const currentCenter = map.getCenter();
                    const distance = google.maps.geometry.spherical.computeDistanceBetween(currentCenter, targetPosition);
                    const heading = google.maps.geometry.spherical.computeHeading(currentCenter, targetPosition);
            
                    const duration = 1000; // Duration of the animation in milliseconds
                    const start = performance.now();
            
                    function animate(time) {
                        const elapsed = time - start;
                        const fraction = Math.min(elapsed / duration, 1);
            
                        const latLng = google.maps.geometry.spherical.computeOffset(
                            currentCenter,
                            distance * fraction,
                            heading
                        );
            
                        map.setCenter(latLng);
            
                        if (fraction < 1) {
                            requestAnimationFrame(animate);
                        }
                    }
            
                    requestAnimationFrame(animate);
                }
            
                function updateLocation() {
                    lat += (Math.random() - 0.5) * 0.001;
                    lng += (Math.random() - 0.5) * 0.001;
                    const newLocation = { lat: lat, lng: lng };
            
                    pathCoordinates.push(newLocation);
            
                    if (pathCoordinates.length > MAX_POINTS) {
                        pathCoordinates.shift();
                    }
            
                    snapToRoad(pathCoordinates, function(snappedCoordinates) {
                        pathCoordinates = snappedCoordinates;
            
                        marker.position = pathCoordinates[pathCoordinates.length - 1];
            
                        const pathLine = new google.maps.Polyline({
                            path: pathCoordinates,
                            geodesic: true,
                            strokeColor: '#FF0000',
                            strokeOpacity: 1.0,
                            strokeWeight: 2,
                        });
            
                        pathLine.setMap(map);
            
                        // Always update marker position, but only animate to marker if not interacting
                        if (!isUserInteracting) {
                            animateToMarker();
                        }
                    });
                }
            
                function snapToRoad(locations, callback) {
                    const chunkSize = MAX_POINTS - PAGINATION_OVERLAP;
                    let snappedPoints = [];
                    let offset = 0;
            
                    function processChunk() {
                        const lowerBound = offset;
                        const upperBound = Math.min(offset + chunkSize, locations.length);
            
                        if (lowerBound >= locations.length) {
                            callback(snappedPoints);
                            return;
                        }
            
                        const path = locations.slice(lowerBound, upperBound).map(loc => `${loc.lat},${loc.lng}`).join('|');
                        const url = `https://roads.googleapis.com/v1/snapToRoads?path=${path}&interpolate=true&key=AIzaSyBxIQBsrTW8PKnM3xNBpRjoBRktyhM4NCk`;
            
                        fetch(url)
                            .then(response => response.json())
                            .then(data => {
                                if (data.snappedPoints && data.snappedPoints.length > 0) {
                                    const snappedLatLngs = data.snappedPoints.map(point => ({
                                        lat: point.location.latitude,
                                        lng: point.location.longitude,
                                    }));
            
                                    if (lowerBound > 0) {
                                        snappedLatLngs.shift(); // Remove overlap points
                                    }
            
                                    snappedPoints = snappedPoints.concat(snappedLatLngs);
                                }
            
                                offset += chunkSize;
                                processChunk();
                            })
                            .catch(error => console.error('Error:', error));
                    }
            
                    processChunk();
                }
            </script>
            
            
            

            


        </div>
    </div>

    <div class="veh">
        
        <div class="vehtittle">
            <div class="vehtittledat" id="vehtittledat"></div>
            <div class="rightnav">
                <button class="setting_button" onclick="toggleForm()">
                    <img src="assets/images/settings.svg" alt="">
                </button>
            </div>

        </div>
        <div class="vehdata">
            <div class="ShowDetail SlideButton" id="showDetailButton">
                <img src="assets/images/SlideButton.svg" alt="">
            </div>
            <div class="nameveh">
                <div class="vehname"></div>
                <div class="user"><img src="assets/images/userv.svg" alt=""></div>
                
            </div>
            <div class="userdat">
                <div class="nameveh">
                    <div class="vehname"><p>Username</p></div>
                    <div class="user" style=" margin-top: 22px; margin-right: 20px; "><img style="width: 50%;" src="assets/images/back.svg" alt=""></div>
                    
                </div>
                <div class="userdat-stats">
                    <div class="Ustats">
                        <div class="UData">
                            <div class="UDat">IDR.4.200.00</div>
                            <div class="Ustat">Salary</div>
                            <div class="Uview">View</div>
                        </div>
                        <div class="UData">
                            <div class="UDat">A</div>
                            <div class="Ustat">Driving License</div>
                            <div class="Uview">View</div>
                        </div>
                        <div class="UData">
                            <div class="UDat">+4 Years</div>
                            <div class="Ustat">Experience</div>
                            <div class="Uview">View</div>
                        </div>
                    </div>
                
                    <div class="Ustats right-align">
                        <div class="UData">
                            <div class="UDat">+62882009031</div>
                            <div class="Ustat">Phone number</div>
                            <div class="Uview"></div>
                        </div>
                        <div class="UData">
                            <div class="UDat" style="color: #9ED573;">2 Times</div>
                            <div class="Ustat">Over Speed History</div>
                            <div class="Uview">View</div>
                        </div>
                        <div class="UData">
                            <div class="UDat">8 hours/d</div>
                            <div class="Ustat">Working Hours</div>
                            <div class="Uview"></div>
                        </div>
                    </div>
                
                    <div class="userimg"><img src="assets/images/UserD.svg" alt=""></div>
                </div>
                
                
            </div>
            
            <div class="vehdat">
               

            <div class="stats">
                
                <div class="Data">
                    <div class="Dat">125 Km/h</div>
                    <div class="stat">Speed <img src="assets/images/rocket_speed.svg" alt=""></div>
                </div>
                <div class="Data">
                    <div class="Dat">532 Km</div>
                    <div class="stat">Traveled</div>
                </div>
                <div class="Data">
                    <div class="Dat">80°C</div>
                    <div class="stat">Temperature</div>
                </div>
                <div class="Data">
                    <div class="Dat">
                        <label class="switch">
                            <input type="checkbox" id="engineStatusCheckbox">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="stat">Engine Status</div>
                </div>
            </div>
            <div class="vehimg"></div>
        </div>
        </div>
    </div>
</div>

    <div class="content_bawah">

        <div class="Last_Trip">
            <div class="LastTrip"><h1>Last Trip</h1></div>
            <div class="LT-Data">
                <div class="LTDat">
                    <div class="trip-item">
                        <div class="trip-content">
                            <div class="trip-details">
                                <div class="time-location">
                                    <img src="assets/images/Pointer.svg" alt="Pointer" class="icon">
                                    <span class="time"><strong>20.00</strong></span>
                                    <span class="location">Tulungagung, Kutoanyar</span>
                                </div>
                                <div class="dotted-line"></div>
                                <div class="time-location">
                                    <img src="assets/images/Location.svg" alt="Location" class="icon">
                                    <span class="time"><strong>21.32</strong></span>
                                    <span class="location">Tulungagung, Kalidawir</span>
                                </div>
                            </div>
                            <div class="vehicle-info">
                                <span class="vehicle-name"></span>
                                <span class="distance">18 km</span>
                            </div>
                        </div>
                        <div class="horizontal-line"></div>
                    </div>
                    <!-- Repeat for more trip items -->
                    <div class="trip-item">
                        <div class="trip-content">
                            <div class="trip-details">
                                <div class="time-location">
                                    <img src="assets/images/Pointer.svg" alt="Pointer" class="icon">
                                    <span class="time"><strong>20.00</strong></span>
                                    <span class="location">Tulungagung, Kalidawir</span>
                                </div>
                                <div class="dotted-line"></div>
                                <div class="time-location">
                                    <img src="assets/images/Location.svg" alt="Location" class="icon">
                                    <span class="time"><strong>21.32</strong></span>
                                    <span class="location">Kediri, Kediri Kota</span>
                                </div>
                            </div>
                            <div class="vehicle-info">
                                <span class="vehicle-name"></span>
                                <span class="distance">32 km</span>
                            </div>
                        </div>
                        <div class="horizontal-line"></div>
                    </div>
                    <!-- Add more trip items as needed -->
                    <div class="trip-item">
                        <div class="trip-content">
                            <div class="trip-details">
                                <div class="time-location">
                                    <img src="assets/images/Pointer.svg" alt="Pointer" class="icon">
                                    <span class="time"><strong>20.00</strong></span>
                                    <span class="location">Tulungagung, Kutoanyar</span>
                                </div>
                                <div class="dotted-line"></div>
                                <div class="time-location">
                                    <img src="assets/images/Location.svg" alt="Location" class="icon">
                                    <span class="time"><strong>21.32</strong></span>
                                    <span class="location">Tulungagung, Kalidawir</span>
                                </div>
                            </div>
                            <div class="vehicle-info">
                                <span class="vehicle-name"></span>
                                <span class="distance">18 km</span>
                            </div>
                        </div>
                        <div class="horizontal-line"></div>
                    </div>
                    
                </div>
            </div>
        </div>

        <div class="content_bawah_kanan">

        <div class="Vehicle_List">
            <div class="Vehicle_List_Tittle tbb ">
                <div class="title-cell">Brand</div>
                <div class="title-cell">Fleet</div>
                <div class="title-cell">Plate No</div>
                <div class="title-cell">Status</div>
                <div class="title-cell">Over Speed Record</div>
            </div>
            <div class="Vehicle_List_Container">
                <div class="Vehicle_List_Row">
                    <div class="row-cell"><img src="assets/images/BMW.svg" alt=""></div>
                    <div class="row-cell fvl">BMW M4</div>
                    <div class="row-cell pvl">AG 1132 AB</div>
                    <div class="row-cell"><img src="assets/images/Inactive.svg" alt=""></div>
                    <div class="row-cell avgos">3 Times</div>
                </div>
                <div class="Vehicle_List_Row">
                    <div class="row-cell"><img src="assets/images/POLESTAR.svg" alt=""></div>
                    <div class="row-cell fvl">POLESTAR 1</div>
                    <div class="row-cell pvl">AG 1132 AB</div>
                    <div class="row-cell"><img src="assets/images/Active.svg" alt=""></div>
                    <div class="row-cell ovos">5 Times</div>
                </div>
                <div class="Vehicle_List_Row">
                    <div class="row-cell"><img src="assets/images/MCB.svg" alt=""></div>
                    <div class="row-cell fvl">AMG GT 4</div>
                    <div class="row-cell pvl">AG 1132 AB</div>
                    <div class="row-cell"><img src="assets/images/Parking.svg" alt=""></div>
                    <div class="row-cell gos">1 Times</div>
                </div>
                <div class="Vehicle_List_Row">
                    <div class="row-cell"><img src="assets/images/BMW.svg" alt=""></div>
                    <div class="row-cell fvl">BMW</div>
                    <div class="row-cell pvl">D 1121 IJ</div>
                    <div class="row-cell"><img src="assets/images/Inactive.svg" alt=""></div>
                    <div class="row-cell gos">1 Times</div>
                </div>
                
                <!-- Tambahkan lebih banyak row sesuai kebutuhan -->
            </div>
        </div>

        <div class="Vehicle_Financing">
            <div class="card_Financing card-gasF">
                <img src="assets/images/Finance_Gas.svg" alt="">
                <div class="card-title_Financing">$13400</div>
                <div class="card-description_Financing">Gas</div>
            </div>
            <div class="card_Financing card-oilF">
                <img src="assets/images/Finance_Oil.svg" alt="">
                <div class="card-title_Financing">$13400</div>
                <div class="card-description_Financing">Oil</div>
            </div>
            <div class="card_Financing card-tollF">
                <img src="assets/images/Finance_Toll.svg" alt="">
                <div class="card-title_Financing">$4212</div>
                <div class="card-description_Financing">Toll</div>
            </div>
            <div class="card_Financing card-washF">
                <img src="assets/images/Finance_Wash.svg" alt="">
                <div class="card-title_Financing">$4212</div>
                <div class="card-description_Financing">Vehicle Wash</div>
            </div>
            <div class="card_Financing add_CardF">
                <img src="assets/images/Button_addCardF.svg" alt="">
            </div>
        </div>

    </div>

    </div>

    <div id="popup" class="popup"></div>  
    <div id="deletePopup" class="popup-container">
    <div class="popup-card">
    <p>Apakah kamu yakin untuk menghapus data ini?</p>
    <button id="confirmDelete">Ya</button>
    <button id="cancelDelete">Tidak</button>
    </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <div class="vehicle-details-container">
        <div class="vehicle-details"></div>
    </div>
    <script type="module" >
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-analytics.js";
        import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-storage.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB9qUzLViR5uALw9Qf_xzJpd20acoV0FEs",
            authDomain: "velinked-web.firebaseapp.com",
            projectId: "velinked-web",
            storageBucket: "velinked-web.appspot.com",
            messagingSenderId: "844821073092",
            appId: "1:844821073092:web:f243c25668079240ec0d91",
            measurementId: "G-CLGQ4RWWTX"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        const form = document.getElementById('vehicleForm');
        const nicknameInput = document.getElementById('nickname');
        const typeSelect = document.getElementById('type');
        const brandSelect = document.getElementById('brand');
        const nameInput = document.getElementById('name');
        const plateInput = document.getElementById('plate');
        const emailInput = document.getElementById('email');
        const picInput = document.getElementById('pic');
        const picPreview = document.getElementById('pic-preview');
        const fileName = document.getElementById('file-name');
        const popup = document.getElementById('popup');

        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[[\]]/g, '\\$&');
            var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }

        const docId = getParameterByName('docId');
        const vehicleDocRef = doc(db, "Vehicle", docId);

        async function fetchVehicleData() {
            try {
                const docSnap = await getDoc(vehicleDocRef);
                if (docSnap.exists()) {
                    const vehicleData = docSnap.data();
                    nicknameInput.value = vehicleData.nickname || '';
                    typeSelect.value = vehicleData.type || '';
                    brandSelect.value = vehicleData.brand || '';
                    nameInput.value = vehicleData.name || '';
                    plateInput.value = vehicleData.plate || '';
                    emailInput.value = vehicleData.email || '';
                    if (vehicleData.picture) {
                        picPreview.src = vehicleData.picture;
                        picPreview.style.width = '25px';
                        picPreview.style.height = '25px';
                        fileName.textContent = 'Picture chosen';
                    }
                } else {
                    console.log("No such document!");
                }
            } catch (error) {
                console.error("Error getting document:", error);
            }
        }

        fetchVehicleData();

        picInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                fileName.textContent = file.name;
                const reader = new FileReader();
                reader.onload = (e) => {
                    picPreview.src = e.target.result;
                    picPreview.style.width = '25px';
                    picPreview.style.height = '25px';
                };
                reader.readAsDataURL(file);
            } else {
                picPreview.src = 'assets/images/Input-vehpic.svg';
                picPreview.style.width = 'auto';
                picPreview.style.height = 'auto';
                fileName.textContent = 'No picture chosen (optional)';
            }
        });

        plateInput.addEventListener('input', (event) => {
            plateInput.value = plateInput.value.toUpperCase();
        });

        async function uploadPicture(file) {
            const storageReference = ref(storage, 'Vehicle/Image/' + file.name);
            await uploadBytes(storageReference, file);
            return await getDownloadURL(storageReference);
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            if (nicknameInput.value.trim() === "") {
                showPopup("Vehicle NickName tidak boleh kosong!");
                return;
            }
            
            if (typeSelect.value.trim() === "") {
                showPopup("Kamu harus memilih Vehicle Type!");
                return;
            }

            if (brandSelect.value.trim() === "") {
                showPopup("Kamu harus memilih Brand Kendaraan!");
                return;
            }

            if (nameInput.value.trim() === "") {
                showPopup("Vehicle Name tidak boleh kosong!");
                return;
            }

            if (plateInput.value.trim() === "") {
                showPopup("Plate no tidak boleh kosong!");
                return;
            }

            let updatedData = {
                nickname: nicknameInput.value,
                type: typeSelect.value,
                brand: brandSelect.value,
                name: nameInput.value,
                plate: plateInput.value.toUpperCase(),
                email: emailInput.value || null
            };

            try {
                showPopup("Uploading data...");
                if (picInput.files[0]) {
                    const pictureURL = await uploadPicture(picInput.files[0]);
                    updatedData.picture = pictureURL;
                }
                await updateDoc(vehicleDocRef, updatedData);
                showPopup("Data berhasil diperbarui!");
                toggleFormEdit();
            } catch (error) {
                console.error("Error updating document:", error);
                showPopup("Terjadi kesalahan saat memperbarui data: " + error.message);
            }
        });

        function showPopup(message) {
            popup.textContent = message;
            popup.style.display = "block";
            setTimeout(() => {
                popup.style.display = "none";
            }, 3000);
        }


    </script>
    <script type="module" src="js/details.js"></script>
</body>
</html>
